# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

Приложение WebLarek разработано с использованием MVP-архитектуры (Model-View-Presenter) с применением брокера событий (EventEmitter) для взаимодействия между компонентами.

### Основные части архитектуры:

•   **Model (Модель):** Отвечает за управление данными приложения, их хранение и обработку. Модели не зависят от UI и содержат бизнес-логику.
•   **View (Представление):** Отображает данные пользователю и обрабатывает пользовательский ввод. Представления пассивны и не содержат бизнес-логики.
•   **Presenter (Представитель):** Действует как посредник между Model и View. Получает данные из Model, форматирует их для View и обрабатывает действия пользователя, передавая их в Model.
•   **API Client:** Отвечает за взаимодействие с внешним API для получения и отправки данных.
•   **Event Emitter (Брокер событий):** Обеспечивает связь между компонентами, позволяя им обмениваться информацией через события.

### Базовые классы

### Класс Api

Класс для работы с API, поддерживает запросы GET и POST (включая PUT и DELETE).

**Свойства:**

- baseUrl: Базовый URL для запросов.
- options: Опции запроса, включая заголовки.

**Методы:**

- constructor(baseUrl: string, options: RequestInit = {}): Инициализация с базовым URL.
- handleResponse(response: Response): Обработка ответа от сервера.
- get(uri: string): Выполнение GET-запроса.
- post(uri: string, data: object, method: ApiPostMethods = 'POST'): Выполнение POST-запроса.

**Типы:**

- ApiListResponse<Type>: Ответ с количеством элементов и данными.
- ApiPostMethods: Типы HTTP-методов: 'POST', 'PUT', 'DELETE'.

### EventEmitter (src/components/base/events.ts)

•   **Предназначение:** Обеспечивает работу с событиями.
•   **Функции:**
    *   on(event: EventName, callback: (data: T) => void): Устанавливает обработчик на событие.
    *   emit(event: string, data?: T): Инициирует событие с данными.
    *   off(eventName: EventName, callback: Subscriber): Снимает обработчик с события.
    *   trigger(event: string, context?: Partial<T>): Создает коллбек-триггер, генерирующий событие при вызове.

### Component (src/components/base/components.ts)

•   **Предназначение:** Базовый класс для всех UI-компонентов.
•   **Функции:**
    *   toggleClass(element: HTMLElement, className: string, force?: boolean): Переключает класс элемента.
    *   setText(element: HTMLElement, value: unknown): Устанавливает текстовое содержимое элемента.
    *   setDisabled(element: HTMLElement, state: boolean): Устанавливает/снимает атрибут disabled у элемента.
    *   setImage(element: HTMLImageElement, src: string, alt?: string): Устанавливает изображение и альтернативный текст.
    *   render(data?: Partial<T>): HTMLElement: Отрисовывает компонент.

### Model (src/components/base/model.ts)

•   **Предназначение:** Базовый класс для всех моделей данных.
•   **Функции:**
    *   emitChanges(event: string, payload?: object): Сообщает всем слушателям об изменении данных в модели.

### Класс AppState

Класс AppState управляет состоянием приложения, связанным с каталогом товаров, корзиной, заказом и обработкой формы. Он расширяет базовый класс Model, предоставляя методы для изменения состояния и оповещения подписчиков об изменениях.

**Свойства:**

- basket: IProductItem[] — массив товаров в корзине.
- catalog: IProductItem[] — массив доступных товаров в каталоге.
- order: IOrder — объект текущего заказа, содержащий информацию о покупателе и товарах.
- preview: string | null — ID товара, выбранного для предпросмотра.
- formErrors: FormErrors — объект, содержащий ошибки валидации формы.

**Методы:**
- setCatalog(items: IProduct[])
  Устанавливает список товаров каталога и отправляет событие обновления.
- setBasket(item: ProductItem)
  Добавляет товар в корзину.
- clearBasket()
  Очищает корзину и отправляет соответствующие события об изменении состояния.
- clearOrder()
  Очищает заказ.
- setItems(item: IProduct)
  Устанавливает товар.
- getBasket()
  Возвращает массив товаров в корзине.
- checkCard(id: string)
  Проверяет, находится ли товар в корзине.
- setPrewiev(item: ProductItem)
  Устанавливает ID товара для предпросмотра и отправляет соответствующее событие.
- removeFromBasket(id: string)
  Удаляет товар из корзины по его ID.
- getTotal()
  Возвращает общую сумму товаров в корзине.
- getBasketNumber()
  Возвращает количество товаров в корзине.
- serOrderField<K extends keyof IUser>(field: K, value: IUser[K])
  Устанавливает поле для заказа.
- validateOrder()
  Проверяет валидность данных заказа.

### Описание компонентов

Ниже описаны компоненты, их атрибуты и методы.

#### ProductItem

•   **Предназначение:** Управление данными о товаре.

•   **Атрибуты:**

    *   id: string - Уникальный идентификатор товара.
    *   title: string - Название товара.
    *   category: string - Категория товара.
    *   description: string - Описание товара.
    *   image: string - URL изображения товара.
    *   price: number | null - Цена товара.

#### Basket

•   **Предназначение:** Управление данными корзины.

•   **Атрибуты:**

    *   items: IBasketItem[] - Массив товаров в корзине.

#### Order

•   **Предназначение:** Управление данными заказа.

•   **Атрибуты:**

    *   paymentMethod: PaymentMethod - Способ оплаты.
    *   address: string - Адрес доставки.
    *   email: string - Email покупателя.
    *   phone: string - Телефон покупателя.

#### Success

•   **Предназначение:** Отображение cообщения об успешном создании заказа.

•   **Атрибуты:**

    *   container: HTMLElement - Контейнер, в котором отображается карточка.
    *   total: number - Общая сумма заказа.

### Компоненты и их взаимодействие

•   **Page (Главная страница):**
    *   Отображает каталог товаров и корзину.
    *   Взаимодействует с AppState для получения данных о товарах и корзине.

•   **Modal (Модальное окно):**
    *   Отображает содержимое корзины, форму заказа, контакты и сообщение об успешном заказе.
    *   Взаимодействует с AppState и другими компонентами для отображения соответствующего контента.

•   **Basket (Корзина):**
    *   Отображает товары в корзине и позволяет оформлять заказ.
    *   Взаимодействует с AppState для получения и изменения данных о корзине

•   **Order (Оформление заказа):**
    *   Отображает форму для ввода данных о заказе (оплата, адрес)
    *   Взаимодействует с AppState для сохранения данных заказа.

### Реализация процессов через события

В приложении активно используется брокер событий для обеспечения взаимодействия между компонентами:

•   Добавление товара в корзину: 'basket:change'
•   Удаление товара из корзины: 'basket:delete-card'
•   Открытие корзины: 'basket:open'
•   Открытие формы заказа: 'order:open'
•   Открытие формы контактов: 'contacts:open'
•   Изменение способа оплаты: 'payment:change'
•   Валидация формы контактов: 'contscts:submit'
•   Открытие и закрытие модального окна: 'modal:open', 'modal:close'